{% extends 'base.html' %}
{% import 'components/table_component.html' as table %}
{% import 'components/header_with_button.html' as header %}

{% block title %}Admin Dashboard{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{{url_for('static', filename='css/common.css')}}">
{% endblock %}

{% block header %}
<header class="p-3 mb-3 border-bottom" style="background-color: #66b775;">
  <div class="d-flex align-items-center justify-content-between w-100">
    <!-- FinSight Logo and Name aligned left -->
    <a href="/" class="d-flex align-items-center mb-2 mb-lg-0 link-body-emphasis text-decoration-none">
      <img src="{{ url_for('static', filename='images/favicon.jpg') }}" alt="FinSight" width="40" height="32" class="me-2">
      <span class="fs-4" style="font-weight: bold; color: #AFD46E;">FinSight</span>
    </a>

    <!-- Navigation links centered -->
    <ul class="nav mb-2 justify-content-center mb-md-0 flex-grow-1">
      <li><a href="#Authentication" class="nav-link px-2 link-secondary">Dashboard</a></li>
      <li><a href="#Events" class="nav-link px-2 link-body-emphasis">Events</a></li>
      <li><a href="#Users table" class="nav-link px-2 link-body-emphasis">Users</a></li>
    </ul>

    <!-- User dropdown aligned right -->
    <div class="dropdown text-end">
      <a href="#" class="d-block link-body-emphasis text-decoration-none dropdown-toggle" data-bs-toggle="dropdown" aria-expanded="false">
        <img src="https://github.com/mdo.png" alt="mdo" width="32" height="32" class="rounded-circle">
      </a>
      <ul class="dropdown-menu text-small">
        <li><a class="dropdown-item" href="{{url_for('home.index')}}">Sign out</a></li>
      </ul>
    </div>
  </div>
</header>
{% endblock %}

{% block content %}
<section id="Authentication">
  <!-- Use header_with_button to render New User button -->
  {% set button1 = {'text': 'New User', 'action': url_for('admin.new_user'), 'class': 'header-button'} %}
  
  <!-- Render the header with title and button -->
  {{ header.render_header(title='User Authentication', buttons=[button1]) }}
  
  <!-- Include the user authentication card -->
  {% include '/components/userauthcard.html' %}
</section>


<section id="Events">
  <!-- Use header_with_button to render two buttons for the Events section -->
  {% set button1 = {'text': 'New Event', 'action': url_for('admin.new_event'), 'class': 'header-button'} %}
  {% set button2 = {'text': 'View Events', 'action': url_for('admin.view_events'), 'class': 'header-button'} %}
  
  {{ header.render_header(
    title='Events',
    buttons=[button1, button2]
  ) }}
  
  {% include '/components/eventcard.html' %}
</section>

<section id="Users table">
  <!-- Use header_with_button to render New User button -->
  {% set button1 = {'text': 'New User', 'action': url_for('admin.new_user'), 'class': 'header-button'} %}
  
  {{ header.render_header(title='User Table', buttons=[button1]) }}
  
  <div>
    <!-- Render the table with the 'is_admin_dashboard' flag set to True -->
    {{ table.render_table(
      users_table, 
      actions=True, 
      identifier_key='user_id', 
      action_buttons=[
        {'endpoint': 'edit', 'label': 'Edit', 'class': 'warning'},
        {'endpoint': 'delete', 'label': 'Delete', 'class': 'danger'}
      ],
      url_patterns={'edit': 'admin.edit_user', 'delete': 'admin.delete_user'}
    ) }}
  </div>
</section>
{% endblock %}
